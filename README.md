# python=3.10.9
# стучимся на http://127.0.0.1:5001/sync_data

Скрипт для синхронизации данных

Скрипт используется для загрузки данных из БД и их синхронизации. Функция sync_data() создает записи, которые есть в JSON, но их нет в базе, а далее обновляет строковые поля там, где что-то поменялось, и помечает удаленными записи, которых нет в JSON, но они все еще есть в базе.

Проект разработан с использованием асинхронного кода и фреймворка Quart для обеспечения надежности и масштабируемости.

===Данные для подключения===
В целях безопасности логин и пароль для подключения к базе данных хранятся в переменных среды:
username_for_sql: Логин для доступа к базе данных.
password_for_sql: Пароль для доступа к базе данных.
app.secret_key: секретный ключ для обеспечения безопасности

===База данных===
Скрипт использует SQLAlchemy для работы с базой данных PostgreSQL. Модель данных MyData, она отображает таблицу в базе данных. Имя таблицы можно задать в переменной table_name.

===Фреймворк Quart===
Для обработки запросов и асинхронной обработки используется фреймворк Quart.
Стандартный маршрут / используется для проверки работоспособности приложения, должно отображаться Hello World.
Маршрут /sync_data для синхронизации данных.

===Логирование===
Логирование осуществляется с использованием библиотеки logging.
Логи записываются в файл app.log с уровнем логирования INFO, включено логирование всех ключевых действий - успешная/неуспешная синхронизация, запуск, логирование ошибок.

===Обработка ошибок===
Используется обработка ошибок при работе с БД - подключение - в случае ошибки сессия корректно закрывается, декодирование JSON и остальные действия

===Зависимости===
К проекту приложены 2 файла с зависимостями: 
requirements.txt с кратким перечнем ключевых библиотек, которые используются в проекте и их версий
requirements-all.txt с полным перечнем всех библиотек, которые могут понадобится и их версий.
Данные обрабатываются асинхронно, .

===Синхронизация данных===
Функция sync_data выполняет асинхронную синхронизацию данных из внешнего источника с базой данных. Она следует следующим шагам:

1) Получение данных из внешнего источника по указанному URL.
2) Получение данных из базы данных.
3) Сравнение данных и выполнение следующих действий:
    + Создание новых записей, если их нет в базе данных.
    + Обновление существующих записей, если они изменились.
    + Пометка записей для удаления, если их нет в полученных данных.
4) Завершение сессии с базой данных и ожидание 1 секунды перед завершением выполнения.
Запуск приложения
Скрипт можно запустить, выполнив его как самостоятельное приложение. В функции main создается событийный цикл asyncio, и приложение Quart запускается с указанным хостом и портом.

===Запуск приложения===
Скрипт можно запустить как самостоятельное приложение.
В функции main создается событийный цикл asyncio, и приложение Quart запускается с указанным хостом и портом, на данный момент запускается на порту 5001.
